<script>
  const counterEl = document.getElementById("counter");
  const startBtn = document.getElementById("startBtn");
  let count = 0;

  // your GitHub audio files
  const sounds = Array.from({ length: 16 }, (_, i) =>
    `https://raw.githubusercontent.com/mariadabrowskam/swearjar/main/${i + 1}.MP3`
  );

  // English swear words + common variants and misspellings
  const swears = [
    "fuck", "fck", "fak", "fack", "fakk", "fuc", "fock", "fucking", "fucker", "motherfucker", "mf",
    "shit", "shiet", "shitty", "sheet", "shiit", "shyt", "shid", "bullshit", "bullsh", "bulszit",
    "bitch", "bish", "bich", "bichh", "beech", "betch", "bitsh",
    "asshole", "ashole", "ass", "azz", "arse", "ashol", "azzhole", "assh", "azzhole",
    "bastard", "bastar", "bastad", "basturt", "basterd",
    "crap", "krap", "crab",
    "damn", "dammit", "damnit", "daymn", "damn it",
    "dick", "dik", "d1ck", "deek", "dikk", "diek",
    "cock", "kock", "kok", "cok", "coq", "cohk", "kawk",
    "pussy", "pusy", "pusi", "poosi", "poosy", "pusee", "pusey",
    "slut", "sloot", "slatt", "slet",
    "whore", "hore", "hoar", "hoer", "whoar", "horr",
    "cum", "cumming", "came", "kom", "coom",
    "blowjob", "bj", "blo job", "blowj", "blojb",
    "boobs", "boob", "bobs", "boobz", "boobies", "tits", "titties", "titty", "teets",
    "balls", "ballz", "bollocks", "bolox", "boloks", "bollok", "bollox", "balz",
    "hell", "hehl", "heel", "hel",
    "wanker", "wank", "wankr", "wankah", "wankerz",
    "jerk", "jerkoff", "jerkin", "jerked",
    "suck", "sucks", "suk", "sux", "sook",
    "hoe", "ho", "hoee", "hoh", "hoeah",
    "craphead", "shithead", "fuckhead", "dickhead", "asshat",
    "twat", "twot", "twatt", "twet",
    "prick", "prik", "prikk", "preek",
    "retard", "retarded", "reetard", "ritard", "retart",
    "dumbass", "stupidass", "fatass", "lazyass",
    "cunt", "cnt", "kunt", "kant", "c0nt", "coont",
    "motherfucking", "goddamn", "goddammit", "holyshit",
    "bullshitting", "dipshit", "jackass", "pieceofshit"
  ];

  function playRandomSound() {
    const randomSound = sounds[Math.floor(Math.random() * sounds.length)];
    const audio = new Audio(randomSound);
    audio.volume = 1.0;
    audio.play().catch((e) => console.warn("ğŸµ Audio blocked:", e));
  }

  function popCounter() {
    counterEl.classList.add("pop");
    setTimeout(() => counterEl.classList.remove("pop"), 400);
  }

  async function startRecognition() {
    startBtn.disabled = true;
    startBtn.textContent = "ğŸ¤ Listening...";

    try {
      await navigator.mediaDevices.getUserMedia({ audio: true });

      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert("Speech recognition not supported in this browser ğŸ˜¢");
        return;
      }

      const recognition = new SpeechRecognition();
      recognition.lang = "en-US";
      recognition.continuous = true;
      recognition.interimResults = false;

      recognition.onstart = () => console.log("ğŸ§ Listening for English swears...");

      recognition.onresult = (event) => {
        const transcript = event.results[event.results.length - 1][0].transcript.toLowerCase().trim();
        console.log("ğŸ—£ï¸ Heard:", transcript);

        // Remove spaces and punctuation
        const cleaned = transcript.replace(/[^\w*]/g, "");

        // detect if text contains censored words like "***" or "******"
        const hasStars = /(\*{2,})/g.test(transcript);

        // detect known swears or phonetic ones
        const hasSwear = swears.some((word) => cleaned.includes(word));

        if (hasSwear || hasStars) {
          count++;
          counterEl.textContent = `Swear count: ${count}`;
          popCounter();
          playRandomSound();
          console.log("ğŸ’¥ Swear detected!");
        }
      };

      recognition.onerror = (err) => {
        console.warn("âš ï¸ Speech error:", err.error);
      };

      recognition.onend = () => {
        console.log("ğŸ” Restarting recognition...");
        recognition.start();
      };

      recognition.start();
    } catch (err) {
      console.error("âŒ Microphone access failed:", err);
      alert("Cannot access microphone ğŸ˜¢");
    }
  }

  startBtn.addEventListener("click", startRecognition);
</script>